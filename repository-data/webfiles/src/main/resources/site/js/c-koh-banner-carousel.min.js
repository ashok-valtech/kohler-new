/*
 * Copyright Â© 2000-2017 Kohler Company. All Rights Reserved.
 */
var axKOH=axKOH||{};axKOH.main=axKOH.main||{},axKOH.main.carouselManager=function(){var initCarousel=function(){var slidesToShow,$components=$(".c-koh-banner-carousel");$components.each(function(componentIndex,element){var isthumbnail=$(element).hasClass("koh-banner-thumbnail-comp"),isHero=$(element).hasClass("v-koh-hero"),isThumbnailRequired=!1;isthumbnail&&(isThumbnailRequired=!0);var $carousels=$(this).children(".koh-carousel");$carousels.each(function(carouselIndex,ele){var sliderIdName="slider_"+componentIndex,sliderNavIdName="sliderNav_"+componentIndex,$carousel=$(this);$carousel.find(".koh-thumbnail-slide-collection").attr("id",sliderIdName),$carousel.find(".koh-thumbnail-slide-navigation").attr("id",sliderNavIdName);var sliderId="#"+sliderIdName,sliderNavId="#"+sliderNavIdName,$carouselControls=$('<div class="koh-carousel-controls"></div>');$carousel.prepend($carouselControls);var $movePrevious=$('<button class="koh-carousel-control previous"><span class="icon"></span><span class="label">Previous</span></button>'),$moveNext=$('<button class="koh-carousel-control next"><span class="icon"></span><span class="label">Next</span></button>');$carouselControls.append($movePrevious),$carouselControls.append($moveNext);var $slideCollection=$carousel.find(".koh-slide-collection"),slideCount=$slideCollection.find(".koh-banner-slide").length;slidesToShow=6>slideCount?2>slideCount?1:slideCount-1:5;var $firstSlide=$slideCollection.find(".koh-banner-slide").first();$slideCollection.each(function(){initSlides($(this),componentIndex+carouselIndex)});var config={autoplay:!1,autoplaySpeed:5e3,adaptiveHeight:!0,dots:!0,dotsClass:"koh-carousel-indicators",arrows:!0,appendArrows:$carouselControls,appendDots:$carouselControls,prevArrow:$movePrevious,nextArrow:$moveNext,pauseOnHover:!0,pauseOnDotsHover:!0,mobileFirst:!0};isThumbnailRequired&&(config.asNavFor=sliderNavId,config.fade=!0),isHero&&(config.autoplay=!0),$slideCollection.slick(config).on("afterChange",function(event,slick,slideIndex){var $slide=$(slick.$slides.get(slideIndex));repositionControls($carouselControls,$slide)}),isThumbnailRequired&&$(sliderNavId).slick({asNavFor:sliderId,slidesToShow:Math.min(5,slidesToShow),slidesToScroll:1,arrows:!1,focusOnSelect:!0,centerMode:!0,variableWidth:!0,responsive:[{breakpoint:550,settings:{slidesToShow:Math.min(3,slidesToShow)}}],responsive:[{breakpoint:480,settings:{slidesToShow:Math.min(2,slidesToShow)}}]});var slick=$slideCollection.slick("getSlick");if(slick){var $indicators=slick.$dots;$indicators&&$indicators.on("click","li",function(){var slick=$slideCollection.slick("getSlick");slick&&(slick.slickSetOption("autoplay",!1,!1),slick.autoPlay=$.noop)})}$(window).load(function(){repositionControls($carouselControls,$firstSlide)}),$(window).resize(function(){waitForFinalEvent(function(){repositionControls($carouselControls,$firstSlide)},100,"carouselTimer"+componentIndex+carouselIndex)})})})},repositionControls=function($controlsContainer,$referenceSlide){var bgWidth="",bgHeight="",$bannerBg=$referenceSlide.children(".koh-banner-background").first();$bannerBg?(bgWidth=$bannerBg.width(),bgHeight=$bannerBg.height()):(bgWidth=$referenceSlide.width(),bgHeight=$referenceSlide.height()),$controlsContainer.width(bgWidth).height(bgHeight)},initSlides=function($slideCollection,containerID){var $slides=$slideCollection.children(".koh-banner-slide");$slides.each(function(slideIndex){var $slide=$(this),$overlayBookmark=$slide.find(".koh-overlay-bookmark"),$overlayBookmarkButton=$overlayBookmark.children(".koh-overlay-bookmark-button"),$overlayBookmarkPanel=$overlayBookmark.children(".koh-overlay-bookmark-form");initOverlayPopover($slide,$overlayBookmarkButton,$overlayBookmarkPanel,"bookmarkPopover"+containerID+slideIndex);var $overlayShare=$slide.find(".koh-overlay-social"),$overlayShareButton=$overlayShare.children(".koh-overlay-share-button"),$overlaySharePanel=$overlayShare.children(".koh-overlay-share-menu");if(axKOH&&axKOH.utils&&axKOH.utils.socialShare&&axKOH.utils.socialShare.initAsTooltip($slide,$overlayShareButton,$overlaySharePanel,"sharePopover"+containerID+slideIndex,"koh-carousel-popover"),$slide.hasClass("v-koh-hotspot")){var $hotspotsContainer=$slide.children(".koh-banner-hotspots").first(),$hotspotHeader=$hotspotsContainer.children(".koh-banner-hotspots-header");$hotspotHeader.click({target:$hotspotsContainer,slideCollection:$slideCollection},function(e){toggleOpen(e.data.target);var $slideSet=e.data.slideCollection,$activeSlide=$slideSet.find(".slick-active");$slideSet.children(".slick-list").height($activeSlide.height())});var $hotspots=$hotspotsContainer.children(".koh-banner-hotspots-collection").children(".koh-banner-hotspot");$hotspots.each(function(hotspotIndex){var $hotspot=$(this),$hotspotButton=$hotspot.children(".koh-banner-hotspot-icon"),$hotspotPanel=$hotspot.children(".koh-banner-hotspot-tile"),tipID="hotspotPopover"+containerID+slideIndex+hotspotIndex;initOverlayHotspot($slide,$hotspotButton,$hotspotPanel,tipID),$(window).resize(function(){waitForFinalEvent(function(){initOverlayHotspot($slide,$hotspotButton,$hotspotPanel,tipID)},100,"carouselTimer"+tipID)})})}if($slide.hasClass("v-koh-video")){var $backgroundLink=$slide.children(".koh-banner-background").children("a"),$videoPanel=$slide.children(".koh-banner-video-panel");initAsModal($backgroundLink,$videoPanel,"CarouselVideo"+containerID+slideIndex),$videoPanel.on("opened",function(){var $embeddedVideo=$(this).find("iframe");resizeResponsiveVideo($embeddedVideo)})}var $bannerBackground=$slide.children(".koh-banner-background"),$bannerContent=$slide.children(".koh-banner-content");$bannerContent.click({background:$bannerBackground},function(e){var $bannerContent=$(this),$bannerBackground=e.data.background;if($bannerContent.offset().top===$bannerBackground.offset().top&&$bannerContent.offset().left===$bannerBackground.offset().left&&$bannerContent.outerWidth()===$bannerBackground.outerWidth()&&$bannerContent.outerHeight()===$bannerBackground.outerHeight()){var $links=$bannerBackground.children("a").first();$links[0].click()}})})},initOverlayPopover=function($slide,$button,$content,tooltipID){$button.qtip({id:tooltipID,content:{text:$content},position:{my:"bottom right",at:"center center",container:$slide,viewport:!0},hide:{when:{event:"mouseout unfocus"},fixed:!0,delay:100},style:{classes:"koh-qtip-popover koh-carousel-popover qtip-light qtip-shadow",tip:!1}})},initOverlayHotspot=function($slide,$button,$content,tooltipID){$(window).width()<980?null!==$button.data("qtip")&&$button.qtip("destroy",!0):$button.qtip({id:tooltipID,content:{text:$content.clone()},position:{my:"right top",at:"left top",container:$slide,viewport:!0,adjust:{method:"flip shift"}},hide:{when:{event:"mouseout unfocus"},fixed:!0,delay:100},style:{classes:"koh-qtip-popover koh-carousel-popover qtip-light qtip-shadow",tip:{mimic:"center",offset:50,width:30,height:15}}})},initAsModal=function($button,$panel,remodalID){$panel.data("remodal-id",remodalID),$panel.prepend('<button data-remodal-action="close" class="remodal-close"></button>'),$panel.attr("data-koh-component","c-koh-banner-carousel"),$panel.addClass("c-koh-banner-carousel-modal");var $remodalPanel=$panel.remodal({hashTracking:!0,closeOnCancel:!0,closeOnEscape:!0,closeOnOutsideClick:!0,modifier:""});$button.data("remodal-target",remodalID),$button.click({target:$remodalPanel},function(e){e.preventDefault(),e.stopPropagation();var $target=e.data.target;$target.open()}),$(document).on("closed",$remodalPanel,function(e){e.target&&axKOH.utils.stopVideos(e.target)})},toggleOpen=function($target){$target.hasClass("open")?$target.removeClass("open"):$target.addClass("open")},makeVideoResponsive=function($videoElement){var aspectRatio=$videoElement.data("aspectratio"),maxWidth=$videoElement.data("maxwidth");if(!aspectRatio||!maxWidth){var width=$videoElement.width(),height=$videoElement.height();aspectRatio=height/width,$videoElement.data("aspectratio",aspectRatio),$videoElement.data("maxwidth",width),$videoElement.removeAttr("width"),$videoElement.removeAttr("height")}},resizeResponsiveVideo=function($videoElement){var embedTags="iframe, object, embed",aspectRatio=$videoElement.data("aspectratio"),maxWidth=$videoElement.data("maxwidth");aspectRatio&&maxWidth||(makeVideoResponsive($videoElement),aspectRatio=$videoElement.data("aspectratio"),maxWidth=$videoElement.data("maxwidth"));var $parent=$videoElement.closest(":not("+embedTags+")"),responsiveWidth=320;$parent&&(responsiveWidth=$parent.width()),responsiveWidth=Math.min(responsiveWidth,maxWidth),$videoElement.width(responsiveWidth),$videoElement.height(responsiveWidth*aspectRatio)},timers={},waitForFinalEvent=function(callback,ms,uniqueId){uniqueId||(uniqueId="UNIQUEID"),timers[uniqueId]&&clearTimeout(timers[uniqueId]),timers[uniqueId]=setTimeout(callback,ms)};return{init:function(){initCarousel()}}}(),$(function(){$(document).ready(function(){axKOH.main.carouselManager.init()})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImMta29oLWJhbm5lci1jYXJvdXNlbC5qcyJdLCJuYW1lcyI6WyJheEtPSCIsIm1haW4iLCJjYXJvdXNlbE1hbmFnZXIiLCJpbml0Q2Fyb3VzZWwiLCJzbGlkZXNUb1Nob3ciLCIkY29tcG9uZW50cyIsIiQiLCJlYWNoIiwiY29tcG9uZW50SW5kZXgiLCJlbGVtZW50IiwiaXN0aHVtYm5haWwiLCJoYXNDbGFzcyIsImlzSGVybyIsImlzVGh1bWJuYWlsUmVxdWlyZWQiLCIkY2Fyb3VzZWxzIiwidGhpcyIsImNoaWxkcmVuIiwiY2Fyb3VzZWxJbmRleCIsImVsZSIsInNsaWRlcklkTmFtZSIsInNsaWRlck5hdklkTmFtZSIsIiRjYXJvdXNlbCIsImZpbmQiLCJhdHRyIiwic2xpZGVySWQiLCJzbGlkZXJOYXZJZCIsIiRjYXJvdXNlbENvbnRyb2xzIiwicHJlcGVuZCIsIiRtb3ZlUHJldmlvdXMiLCIkbW92ZU5leHQiLCJhcHBlbmQiLCIkc2xpZGVDb2xsZWN0aW9uIiwic2xpZGVDb3VudCIsImxlbmd0aCIsIiRmaXJzdFNsaWRlIiwiZmlyc3QiLCJpbml0U2xpZGVzIiwiY29uZmlnIiwiYXV0b3BsYXkiLCJhdXRvcGxheVNwZWVkIiwiYWRhcHRpdmVIZWlnaHQiLCJkb3RzIiwiZG90c0NsYXNzIiwiYXJyb3dzIiwiYXBwZW5kQXJyb3dzIiwiYXBwZW5kRG90cyIsInByZXZBcnJvdyIsIm5leHRBcnJvdyIsInBhdXNlT25Ib3ZlciIsInBhdXNlT25Eb3RzSG92ZXIiLCJtb2JpbGVGaXJzdCIsInNsaWNrIiwib24iLCJldmVudCIsInNsaWRlSW5kZXgiLCIkc2xpZGUiLCIkc2xpZGVzIiwiZ2V0IiwicmVwb3NpdGlvbkNvbnRyb2xzIiwiYXNOYXZGb3IiLCJNYXRoIiwibWluIiwic2xpZGVzVG9TY3JvbGwiLCJmb2N1c09uU2VsZWN0IiwiY2VudGVyTW9kZSIsInZhcmlhYmxlV2lkdGgiLCJyZXNwb25zaXZlIiwiYnJlYWtwb2ludCIsInNldHRpbmdzIiwiJGluZGljYXRvcnMiLCIkZG90cyIsInNsaWNrU2V0T3B0aW9uIiwiYXV0b1BsYXkiLCJub29wIiwid2luZG93IiwibG9hZCIsInJlc2l6ZSIsIndhaXRGb3JGaW5hbEV2ZW50IiwiJGNvbnRyb2xzQ29udGFpbmVyIiwiJHJlZmVyZW5jZVNsaWRlIiwiYmdXaWR0aCIsImJnSGVpZ2h0IiwiJGJhbm5lckJnIiwid2lkdGgiLCJoZWlnaHQiLCJjb250YWluZXJJRCIsIiRvdmVybGF5Qm9va21hcmsiLCIkb3ZlcmxheUJvb2ttYXJrQnV0dG9uIiwiJG92ZXJsYXlCb29rbWFya1BhbmVsIiwiaW5pdE92ZXJsYXlQb3BvdmVyIiwiJG92ZXJsYXlTaGFyZSIsIiRvdmVybGF5U2hhcmVCdXR0b24iLCIkb3ZlcmxheVNoYXJlUGFuZWwiLCJ1dGlscyIsInNvY2lhbFNoYXJlIiwiaW5pdEFzVG9vbHRpcCIsIiRob3RzcG90c0NvbnRhaW5lciIsIiRob3RzcG90SGVhZGVyIiwiY2xpY2siLCJ0YXJnZXQiLCJzbGlkZUNvbGxlY3Rpb24iLCJlIiwidG9nZ2xlT3BlbiIsImRhdGEiLCIkc2xpZGVTZXQiLCIkYWN0aXZlU2xpZGUiLCIkaG90c3BvdHMiLCJob3RzcG90SW5kZXgiLCIkaG90c3BvdCIsIiRob3RzcG90QnV0dG9uIiwiJGhvdHNwb3RQYW5lbCIsInRpcElEIiwiaW5pdE92ZXJsYXlIb3RzcG90IiwiJGJhY2tncm91bmRMaW5rIiwiJHZpZGVvUGFuZWwiLCJpbml0QXNNb2RhbCIsIiRlbWJlZGRlZFZpZGVvIiwicmVzaXplUmVzcG9uc2l2ZVZpZGVvIiwiJGJhbm5lckJhY2tncm91bmQiLCIkYmFubmVyQ29udGVudCIsImJhY2tncm91bmQiLCJvZmZzZXQiLCJ0b3AiLCJsZWZ0Iiwib3V0ZXJXaWR0aCIsIm91dGVySGVpZ2h0IiwiJGxpbmtzIiwiJGJ1dHRvbiIsIiRjb250ZW50IiwidG9vbHRpcElEIiwicXRpcCIsImlkIiwiY29udGVudCIsInRleHQiLCJwb3NpdGlvbiIsIm15IiwiYXQiLCJjb250YWluZXIiLCJ2aWV3cG9ydCIsImhpZGUiLCJ3aGVuIiwiZml4ZWQiLCJkZWxheSIsInN0eWxlIiwiY2xhc3NlcyIsInRpcCIsImNsb25lIiwiYWRqdXN0IiwibWV0aG9kIiwibWltaWMiLCIkcGFuZWwiLCJyZW1vZGFsSUQiLCJhZGRDbGFzcyIsIiRyZW1vZGFsUGFuZWwiLCJyZW1vZGFsIiwiaGFzaFRyYWNraW5nIiwiY2xvc2VPbkNhbmNlbCIsImNsb3NlT25Fc2NhcGUiLCJjbG9zZU9uT3V0c2lkZUNsaWNrIiwibW9kaWZpZXIiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsIiR0YXJnZXQiLCJvcGVuIiwiZG9jdW1lbnQiLCJzdG9wVmlkZW9zIiwicmVtb3ZlQ2xhc3MiLCJtYWtlVmlkZW9SZXNwb25zaXZlIiwiJHZpZGVvRWxlbWVudCIsImFzcGVjdFJhdGlvIiwibWF4V2lkdGgiLCJyZW1vdmVBdHRyIiwiZW1iZWRUYWdzIiwiJHBhcmVudCIsImNsb3Nlc3QiLCJyZXNwb25zaXZlV2lkdGgiLCJ0aW1lcnMiLCJjYWxsYmFjayIsIm1zIiwidW5pcXVlSWQiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiaW5pdCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOzs7QUFJQSxHQUFJQSxPQUFRQSxTQUVaQSxPQUFNQyxLQUFPRCxNQUFNQyxTQUVuQkQsTUFBTUMsS0FBS0MsZ0JBQWtCLFdBRXpCLEdBQUlDLGNBQWUsV0FFZixHQUErQ0MsY0FBM0NDLFlBQWNDLEVBQUUseUJBRXBCRCxhQUFZRSxLQUFLLFNBQVVDLGVBQWdCQyxTQUN2QyxHQUFJQyxhQUFjSixFQUFFRyxTQUFTRSxTQUFTLDZCQUNsQ0MsT0FBU04sRUFBRUcsU0FBU0UsU0FBUyxjQUM3QkUscUJBQXNCLENBQ3RCSCxlQUNBRyxxQkFBc0IsRUFJMUIsSUFBSUMsWUFBYVIsRUFBRVMsTUFBTUMsU0FBUyxnQkFFbENGLFlBQVdQLEtBQUssU0FBVVUsY0FBZUMsS0FFckMsR0FBSUMsY0FBZSxVQUFZWCxlQUMzQlksZ0JBQWtCLGFBQWVaLGVBRWpDYSxVQUFZZixFQUFFUyxLQUVsQk0sV0FBVUMsS0FBSyxtQ0FBbUNDLEtBQUssS0FBTUosY0FDN0RFLFVBQVVDLEtBQUssbUNBQW1DQyxLQUFLLEtBQU1ILGdCQUU3RCxJQUFJSSxVQUFXLElBQU1MLGFBQ2pCTSxZQUFjLElBQU1MLGdCQUlwQk0sa0JBQW9CcEIsRUFBRSw0Q0FDMUJlLFdBQVVNLFFBQVFELGtCQUVsQixJQUFJRSxlQUFnQnRCLEVBQUUsd0hBQ2xCdUIsVUFBWXZCLEVBQUUsK0dBQ2xCb0IsbUJBQWtCSSxPQUFPRixlQUN6QkYsa0JBQWtCSSxPQUFPRCxVQUd6QixJQUFJRSxrQkFBbUJWLFVBQVVDLEtBQUsseUJBQ2xDVSxXQUFhRCxpQkFBaUJULEtBQUsscUJBQXFCVyxNQUdwRDdCLGNBRlMsRUFBYjRCLFdBQ2lCLEVBQWJBLFdBQ2UsRUFFQUEsV0FBYSxFQUdqQixDQUVuQixJQUFJRSxhQUFjSCxpQkFBaUJULEtBQUsscUJBQXFCYSxPQUc3REosa0JBQWlCeEIsS0FBSyxXQUNsQjZCLFdBQVc5QixFQUFFUyxNQUFPUCxlQUFpQlMsZ0JBR3pDLElBQUlvQixTQUNBQyxVQUFVLEVBQ1ZDLGNBQWUsSUFDZkMsZ0JBQWdCLEVBQ2hCQyxNQUFNLEVBQ05DLFVBQVcsMEJBQ1hDLFFBQVEsRUFDUkMsYUFBY2xCLGtCQUNkbUIsV0FBWW5CLGtCQUNab0IsVUFBV2xCLGNBQ1htQixVQUFXbEIsVUFDWG1CLGNBQWMsRUFDZEMsa0JBQWtCLEVBQ2xCQyxhQUFhLEVBRWJyQyx1QkFDQXdCLE9BQWlCLFNBQUlaLFlBQ3JCWSxPQUFhLE1BQUksR0FFakJ6QixTQUNBeUIsT0FBaUIsVUFBSSxHQUl6Qk4saUJBQ0tvQixNQUFNZCxRQUFRZSxHQUFHLGNBQWUsU0FBVUMsTUFBT0YsTUFBT0csWUFDckQsR0FBSUMsUUFBU2pELEVBQUU2QyxNQUFNSyxRQUFRQyxJQUFJSCxZQUNqQ0ksb0JBQW1CaEMsa0JBQW1CNkIsVUFHMUMxQyxxQkFDQVAsRUFBRW1CLGFBQWEwQixPQUNYUSxTQUFVbkMsU0FDVnBCLGFBQWN3RCxLQUFLQyxJQUFJLEVBQUd6RCxjQUMxQjBELGVBQWdCLEVBQ2hCbkIsUUFBUSxFQUNSb0IsZUFBZSxFQUNmQyxZQUFZLEVBQ1pDLGVBQWUsRUFDZkMsYUFFUUMsV0FBWSxJQUNaQyxVQUNJaEUsYUFBY3dELEtBQUtDLElBQUksRUFBR3pELGlCQUl0QzhELGFBRVFDLFdBQVksSUFDWkMsVUFDSWhFLGFBQWN3RCxLQUFLQyxJQUFJLEVBQUd6RCxrQkFNOUMsSUFBSStDLE9BQVFwQixpQkFBaUJvQixNQUFNLFdBQ25DLElBQUlBLE1BQU8sQ0FDUCxHQUFJa0IsYUFBY2xCLE1BQU1tQixLQUNwQkQsY0FDQUEsWUFBWWpCLEdBQUcsUUFBUyxLQUFNLFdBQzFCLEdBQUlELE9BQVFwQixpQkFBaUJvQixNQUFNLFdBQy9CQSxTQUNBQSxNQUFNb0IsZUFBZSxZQUFZLEdBQU8sR0FDeENwQixNQUFNcUIsU0FBV2xFLEVBQUVtRSxRQVFuQ25FLEVBQUVvRSxRQUFRQyxLQUFLLFdBQ1hqQixtQkFBbUJoQyxrQkFBbUJRLGVBRTFDNUIsRUFBRW9FLFFBQVFFLE9BQU8sV0FDYkMsa0JBQWtCLFdBQ2RuQixtQkFBbUJoQyxrQkFBbUJRLGNBQ3ZDLElBQUssZ0JBQWtCMUIsZUFBaUJTLHNCQU92RHlDLG1CQUFxQixTQUFVb0IsbUJBQW9CQyxpQkFDbkQsR0FBSUMsU0FBVSxHQUNWQyxTQUFXLEdBRVhDLFVBQVlILGdCQUFnQi9ELFNBQVMsMEJBQTBCbUIsT0FDL0QrQyxZQUNBRixRQUFVRSxVQUFVQyxRQUNwQkYsU0FBV0MsVUFBVUUsV0FFckJKLFFBQVVELGdCQUFnQkksUUFDMUJGLFNBQVdGLGdCQUFnQkssVUFHL0JOLG1CQUFtQkssTUFBTUgsU0FBU0ksT0FBT0gsV0FHekM3QyxXQUFhLFNBQVVMLGlCQUFrQnNELGFBRXpDLEdBQUk3QixTQUFVekIsaUJBQWlCZixTQUFTLG9CQUV4Q3dDLFNBQVFqRCxLQUFLLFNBQVUrQyxZQUNuQixHQUFJQyxRQUFTakQsRUFBRVMsTUFHWHVFLGlCQUFtQi9CLE9BQU9qQyxLQUFLLHlCQUMvQmlFLHVCQUF5QkQsaUJBQWlCdEUsU0FBUyxnQ0FDbkR3RSxzQkFBd0JGLGlCQUFpQnRFLFNBQVMsNkJBQ3REeUUsb0JBQW1CbEMsT0FBUWdDLHVCQUF3QkMsc0JBQXVCLGtCQUFvQkgsWUFBYy9CLFdBRTVHLElBQUlvQyxlQUFnQm5DLE9BQU9qQyxLQUFLLHVCQUM1QnFFLG9CQUFzQkQsY0FBYzFFLFNBQVMsNkJBQzdDNEUsbUJBQXFCRixjQUFjMUUsU0FBUywwQkFNaEQsSUFMSWhCLE9BQVNBLE1BQU02RixPQUFTN0YsTUFBTTZGLE1BQU1DLGFBQ3BDOUYsTUFBTTZGLE1BQU1DLFlBQVlDLGNBQWN4QyxPQUFRb0Msb0JBQXFCQyxtQkFBb0IsZUFBaUJQLFlBQWMvQixXQUFZLHdCQUlsSUMsT0FBTzVDLFNBQVMsaUJBQWtCLENBQ2xDLEdBQUlxRixvQkFBcUJ6QyxPQUFPdkMsU0FBUyx3QkFBd0JtQixRQUU3RDhELGVBQWlCRCxtQkFBbUJoRixTQUFTLDhCQUNqRGlGLGdCQUFlQyxPQUNYQyxPQUFRSCxtQkFDUkksZ0JBQWlCckUsa0JBQ2xCLFNBQVVzRSxHQUNUQyxXQUFXRCxFQUFFRSxLQUFLSixPQUdsQixJQUFJSyxXQUFZSCxFQUFFRSxLQUFLSCxnQkFDbkJLLGFBQWVELFVBQVVsRixLQUFLLGdCQUNsQ2tGLFdBQVV4RixTQUFTLGVBQWVvRSxPQUFPcUIsYUFBYXJCLFdBRzFELElBQUlzQixXQUFZVixtQkFBbUJoRixTQUFTLG1DQUFtQ0EsU0FBUyxzQkFDeEYwRixXQUFVbkcsS0FBSyxTQUFVb0csY0FDckIsR0FBSUMsVUFBV3RHLEVBQUVTLE1BQ2I4RixlQUFpQkQsU0FBUzVGLFNBQVMsNEJBQ25DOEYsY0FBZ0JGLFNBQVM1RixTQUFTLDRCQUNsQytGLE1BQVEsaUJBQW1CMUIsWUFBYy9CLFdBQWFxRCxZQUMxREssb0JBQW1CekQsT0FBUXNELGVBQWdCQyxjQUFlQyxPQUMxRHpHLEVBQUVvRSxRQUFRRSxPQUFPLFdBQ2JDLGtCQUFrQixXQUNkbUMsbUJBQW1CekQsT0FBUXNELGVBQWdCQyxjQUFlQyxRQUMzRCxJQUFLLGdCQUFrQkEsV0FLdEMsR0FBSXhELE9BQU81QyxTQUFTLGVBQWdCLENBRWhDLEdBQUlzRyxpQkFBa0IxRCxPQUFPdkMsU0FBUywwQkFBMEJBLFNBQVMsS0FDckVrRyxZQUFjM0QsT0FBT3ZDLFNBQVMsMEJBRWxDbUcsYUFBWUYsZ0JBQWlCQyxZQUFhLGdCQUFrQjdCLFlBQWMvQixZQUMxRTRELFlBQVk5RCxHQUFHLFNBQVUsV0FDckIsR0FBSWdFLGdCQUFpQjlHLEVBQUVTLE1BQU1PLEtBQUssU0FDbEMrRix1QkFBc0JELGtCQU05QixHQUFJRSxtQkFBb0IvRCxPQUFPdkMsU0FBUywwQkFDcEN1RyxlQUFpQmhFLE9BQU92QyxTQUFTLHNCQUNyQ3VHLGdCQUFlckIsT0FDWHNCLFdBQVlGLG1CQUNiLFNBQVVqQixHQUNULEdBQUlrQixnQkFBaUJqSCxFQUFFUyxNQUNuQnVHLGtCQUFvQmpCLEVBQUVFLEtBQUtpQixVQUUvQixJQUFLRCxlQUFlRSxTQUFTQyxNQUFRSixrQkFBa0JHLFNBQVNDLEtBQzNESCxlQUFlRSxTQUFTRSxPQUFTTCxrQkFBa0JHLFNBQVNFLE1BQzVESixlQUFlSyxlQUFpQk4sa0JBQWtCTSxjQUNsREwsZUFBZU0sZ0JBQWtCUCxrQkFBa0JPLGNBQWdCLENBQ3BFLEdBQUlDLFFBQVNSLGtCQUFrQnRHLFNBQVMsS0FBS21CLE9BRzdDMkYsUUFBTyxHQUFHNUIsY0FNdEJULG1CQUFxQixTQUFVbEMsT0FBUXdFLFFBQVNDLFNBQVVDLFdBQzFERixRQUFRRyxNQUNKQyxHQUFJRixVQUNKRyxTQUNJQyxLQUFNTCxVQUVWTSxVQUNJQyxHQUFJLGVBQ0pDLEdBQUksZ0JBQ0pDLFVBQVdsRixPQUNYbUYsVUFBVSxHQUVkQyxNQUNJQyxNQUNJdkYsTUFBTyxvQkFFWHdGLE9BQU8sRUFDUEMsTUFBTyxLQUVYQyxPQUNJQyxRQUFTLCtEQUNUQyxLQUFLLE1BS2JqQyxtQkFBcUIsU0FBVXpELE9BQVF3RSxRQUFTQyxTQUFVQyxXQUV0RDNILEVBQUVvRSxRQUFRUyxRQUFVLElBQ1MsT0FBekI0QyxRQUFReEIsS0FBSyxTQUNid0IsUUFBUUcsS0FBSyxXQUFXLEdBSzVCSCxRQUFRRyxNQUNKQyxHQUFJRixVQUNKRyxTQUNJQyxLQUFNTCxTQUFTa0IsU0FFbkJaLFVBQ0lDLEdBQUksWUFDSkMsR0FBSSxXQUNKQyxVQUFXbEYsT0FDWG1GLFVBQVUsRUFDVlMsUUFDSUMsT0FBUSxlQUdoQlQsTUFDSUMsTUFDSXZGLE1BQU8sb0JBRVh3RixPQUFPLEVBQ1BDLE1BQU8sS0FFWEMsT0FDSUMsUUFBUywrREFDVEMsS0FDSUksTUFBTyxTQUNQNUIsT0FBUSxHQUNSdEMsTUFBTyxHQUNQQyxPQUFRLFFBUXhCK0IsWUFBYyxTQUFVWSxRQUFTdUIsT0FBUUMsV0FDekNELE9BQU8vQyxLQUFLLGFBQWNnRCxXQUMxQkQsT0FBTzNILFFBQVEsdUVBQ2YySCxPQUFPL0gsS0FBSyxxQkFBc0IseUJBQ2xDK0gsT0FBT0UsU0FBUyw4QkFFaEIsSUFBSUMsZUFBZ0JILE9BQU9JLFNBQ3ZCQyxjQUFjLEVBQ2RDLGVBQWUsRUFDZkMsZUFBZSxFQUNmQyxxQkFBcUIsRUFDckJDLFNBQVUsSUFJZGhDLFNBQVF4QixLQUFLLGlCQUFrQmdELFdBQy9CeEIsUUFBUTdCLE9BQ0pDLE9BQVFzRCxlQUNULFNBQVVwRCxHQUNUQSxFQUFFMkQsaUJBQ0YzRCxFQUFFNEQsaUJBQ0YsSUFBSUMsU0FBVTdELEVBQUVFLEtBQUtKLE1BQ3JCK0QsU0FBUUMsU0FJWjdKLEVBQUU4SixVQUFVaEgsR0FBRyxTQUFVcUcsY0FBZSxTQUFVcEQsR0FDMUNBLEVBQUVGLFFBQ0ZuRyxNQUFNNkYsTUFBTXdFLFdBQVdoRSxFQUFFRixXQUtqQ0csV0FBYSxTQUFVNEQsU0FDbkJBLFFBQVF2SixTQUFTLFFBQ2pCdUosUUFBUUksWUFBWSxRQUVwQkosUUFBUVYsU0FBUyxTQUlyQmUsb0JBQXNCLFNBQVVDLGVBQ2hDLEdBQUlDLGFBQWNELGNBQWNqRSxLQUFLLGVBQ2pDbUUsU0FBV0YsY0FBY2pFLEtBQUssV0FFbEMsS0FBS2tFLGNBQWdCQyxTQUFVLENBQzNCLEdBQUl2RixPQUFRcUYsY0FBY3JGLFFBQ3RCQyxPQUFTb0YsY0FBY3BGLFFBRTNCcUYsYUFBY3JGLE9BQVNELE1BR3ZCcUYsY0FBY2pFLEtBQUssY0FBZWtFLGFBQ2xDRCxjQUFjakUsS0FBSyxXQUFZcEIsT0FDL0JxRixjQUFjRyxXQUFXLFNBQ3pCSCxjQUFjRyxXQUFXLFlBSTdCdEQsc0JBQXdCLFNBQVVtRCxlQUNsQyxHQUFJSSxXQUFZLHdCQUNaSCxZQUFjRCxjQUFjakUsS0FBSyxlQUNqQ21FLFNBQVdGLGNBQWNqRSxLQUFLLFdBRTdCa0UsY0FBZ0JDLFdBQ2pCSCxvQkFBb0JDLGVBQ3BCQyxZQUFjRCxjQUFjakUsS0FBSyxlQUNqQ21FLFNBQVdGLGNBQWNqRSxLQUFLLFlBR2xDLElBQUlzRSxTQUFVTCxjQUFjTSxRQUFRLFFBQVVGLFVBQVksS0FFdERHLGdCQUFrQixHQUNsQkYsV0FDQUUsZ0JBQWtCRixRQUFRMUYsU0FHOUI0RixnQkFBa0JuSCxLQUFLQyxJQUFJa0gsZ0JBQWlCTCxVQUU1Q0YsY0FBY3JGLE1BQU00RixpQkFDcEJQLGNBQWNwRixPQUFPMkYsZ0JBQWtCTixjQUd2Q08sVUFDQW5HLGtCQUFvQixTQUFVb0csU0FBVUMsR0FBSUMsVUFDdkNBLFdBQ0RBLFNBQVcsWUFFWEgsT0FBT0csV0FDUEMsYUFBYUosT0FBT0csV0FFeEJILE9BQU9HLFVBQVlFLFdBQVdKLFNBQVVDLElBSTVDLFFBQ0lJLEtBQU0sV0FDRm5MLG9CQUtaRyxFQUFFLFdBQ0VBLEVBQUU4SixVQUFVbUIsTUFBTSxXQUVkdkwsTUFBTUMsS0FBS0MsZ0JBQWdCb0wiLCJmaWxlIjoiYy1rb2gtYmFubmVyLWNhcm91c2VsLm1pbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIENvcHlyaWdodCDCqSAyMDAwLTIwMTcgS29obGVyIENvbXBhbnkuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXHJcbiAqL1xyXG5cclxudmFyIGF4S09IID0gYXhLT0ggfHwge307XHJcblxyXG5heEtPSC5tYWluID0gYXhLT0gubWFpbiB8fCB7fTtcclxuXHJcbmF4S09ILm1haW4uY2Fyb3VzZWxNYW5hZ2VyID0gKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgaW5pdENhcm91c2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIExvY2F0ZSBhbGwgaW5zdGFuY2VzIG9mIHRoZSBjb21wb25lbnRcclxuICAgICAgICB2YXIgJGNvbXBvbmVudHMgPSAkKFwiLmMta29oLWJhbm5lci1jYXJvdXNlbFwiKSwgc2xpZGVzVG9TaG93O1xyXG5cclxuICAgICAgICAkY29tcG9uZW50cy5lYWNoKGZ1bmN0aW9uIChjb21wb25lbnRJbmRleCwgZWxlbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgaXN0aHVtYm5haWwgPSAkKGVsZW1lbnQpLmhhc0NsYXNzKCdrb2gtYmFubmVyLXRodW1ibmFpbC1jb21wJyk7XHJcbiAgICAgICAgICAgIHZhciBpc0hlcm8gPSAkKGVsZW1lbnQpLmhhc0NsYXNzKCd2LWtvaC1oZXJvJyk7XHJcbiAgICAgICAgICAgIHZhciBpc1RodW1ibmFpbFJlcXVpcmVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChpc3RodW1ibmFpbCkge1xyXG4gICAgICAgICAgICAgICAgaXNUaHVtYm5haWxSZXF1aXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIG1haW4gY2Fyb3VzZWwgZWxlbWVudFxyXG4gICAgICAgICAgICB2YXIgJGNhcm91c2VscyA9ICQodGhpcykuY2hpbGRyZW4oXCIua29oLWNhcm91c2VsXCIpO1xyXG5cclxuICAgICAgICAgICAgJGNhcm91c2Vscy5lYWNoKGZ1bmN0aW9uIChjYXJvdXNlbEluZGV4LCBlbGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVySWROYW1lID0gJ3NsaWRlcl8nICsgY29tcG9uZW50SW5kZXg7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVyTmF2SWROYW1lID0gJ3NsaWRlck5hdl8nICsgY29tcG9uZW50SW5kZXg7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyICRjYXJvdXNlbCA9ICQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5rb2gtdGh1bWJuYWlsLXNsaWRlLWNvbGxlY3Rpb24nKS5hdHRyKCdpZCcsIHNsaWRlcklkTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLmtvaC10aHVtYm5haWwtc2xpZGUtbmF2aWdhdGlvbicpLmF0dHIoJ2lkJywgc2xpZGVyTmF2SWROYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVySWQgPSAnIycgKyBzbGlkZXJJZE5hbWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVyTmF2SWQgPSAnIycgKyBzbGlkZXJOYXZJZE5hbWU7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFkZGluZyBhIGRpdiB0byB0aGUgY2Fyb3VzZWwgc28gd2UgY2FuIGdyb3VwIHRoZSBjb250cm9sc1xyXG4gICAgICAgICAgICAgICAgdmFyICRjYXJvdXNlbENvbnRyb2xzID0gJCgnPGRpdiBjbGFzcz1cImtvaC1jYXJvdXNlbC1jb250cm9sc1wiPjwvZGl2PicpO1xyXG4gICAgICAgICAgICAgICAgJGNhcm91c2VsLnByZXBlbmQoJGNhcm91c2VsQ29udHJvbHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciAkbW92ZVByZXZpb3VzID0gJCgnPGJ1dHRvbiBjbGFzcz1cImtvaC1jYXJvdXNlbC1jb250cm9sIHByZXZpb3VzXCI+PHNwYW4gY2xhc3M9XCJpY29uXCI+PC9zcGFuPjxzcGFuIGNsYXNzPVwibGFiZWxcIj5QcmV2aW91czwvc3Bhbj48L2J1dHRvbj4nKTtcclxuICAgICAgICAgICAgICAgIHZhciAkbW92ZU5leHQgPSAkKCc8YnV0dG9uIGNsYXNzPVwia29oLWNhcm91c2VsLWNvbnRyb2wgbmV4dFwiPjxzcGFuIGNsYXNzPVwiaWNvblwiPjwvc3Bhbj48c3BhbiBjbGFzcz1cImxhYmVsXCI+TmV4dDwvc3Bhbj48L2J1dHRvbj4nKTtcclxuICAgICAgICAgICAgICAgICRjYXJvdXNlbENvbnRyb2xzLmFwcGVuZCgkbW92ZVByZXZpb3VzKTtcclxuICAgICAgICAgICAgICAgICRjYXJvdXNlbENvbnRyb2xzLmFwcGVuZCgkbW92ZU5leHQpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIHNsaWRlc1xyXG4gICAgICAgICAgICAgICAgdmFyICRzbGlkZUNvbGxlY3Rpb24gPSAkY2Fyb3VzZWwuZmluZChcIi5rb2gtc2xpZGUtY29sbGVjdGlvblwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBzbGlkZUNvdW50ID0gJHNsaWRlQ29sbGVjdGlvbi5maW5kKFwiLmtvaC1iYW5uZXItc2xpZGVcIikubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlQ291bnQgPCA2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNsaWRlQ291bnQgPCAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2hvdyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzVG9TaG93ID0gc2xpZGVDb3VudCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Nob3cgPSA1O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyICRmaXJzdFNsaWRlID0gJHNsaWRlQ29sbGVjdGlvbi5maW5kKFwiLmtvaC1iYW5uZXItc2xpZGVcIikuZmlyc3QoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBGb3IgZWFjaCBzbGlkZSBjb2xsZWN0aW9uLCBpbml0aWFsaXplIHRoZSBzbGlkZXNcclxuICAgICAgICAgICAgICAgICRzbGlkZUNvbGxlY3Rpb24uZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdFNsaWRlcygkKHRoaXMpLCBjb21wb25lbnRJbmRleCArIGNhcm91c2VsSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRvcGxheTogZmFsc2UsIC8vIG5ldmVyIGF1dG9wbGF5IG9uIFwibW9iaWxlXCJcclxuICAgICAgICAgICAgICAgICAgICBhdXRvcGxheVNwZWVkOiA1ZTMsXHJcbiAgICAgICAgICAgICAgICAgICAgYWRhcHRpdmVIZWlnaHQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZG90czogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBkb3RzQ2xhc3M6IFwia29oLWNhcm91c2VsLWluZGljYXRvcnNcIixcclxuICAgICAgICAgICAgICAgICAgICBhcnJvd3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgYXBwZW5kQXJyb3dzOiAkY2Fyb3VzZWxDb250cm9scyxcclxuICAgICAgICAgICAgICAgICAgICBhcHBlbmREb3RzOiAkY2Fyb3VzZWxDb250cm9scyxcclxuICAgICAgICAgICAgICAgICAgICBwcmV2QXJyb3c6ICRtb3ZlUHJldmlvdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dEFycm93OiAkbW92ZU5leHQsXHJcbiAgICAgICAgICAgICAgICAgICAgcGF1c2VPbkhvdmVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhdXNlT25Eb3RzSG92ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbW9iaWxlRmlyc3Q6IHRydWVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNUaHVtYm5haWxSZXF1aXJlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ1snYXNOYXZGb3InXSA9IHNsaWRlck5hdklkO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ1snZmFkZSddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpc0hlcm8pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWdbJ2F1dG9wbGF5J10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGNhcm91c2VsXHJcbiAgICAgICAgICAgICAgICAkc2xpZGVDb2xsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgLnNsaWNrKGNvbmZpZykub24oJ2FmdGVyQ2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50LCBzbGljaywgc2xpZGVJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHNsaWRlID0gJChzbGljay4kc2xpZGVzLmdldChzbGlkZUluZGV4KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9zaXRpb25Db250cm9scygkY2Fyb3VzZWxDb250cm9scywgJHNsaWRlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNUaHVtYm5haWxSZXF1aXJlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoc2xpZGVyTmF2SWQpLnNsaWNrKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNOYXZGb3I6IHNsaWRlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Nob3c6IE1hdGgubWluKDUsIHNsaWRlc1RvU2hvdyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJvd3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb2N1c09uU2VsZWN0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXJNb2RlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZVdpZHRoOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtwb2ludDogNTUwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2hvdzogTWF0aC5taW4oMywgc2xpZGVzVG9TaG93KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha3BvaW50OiA0ODAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzVG9TaG93OiBNYXRoLm1pbigyLCBzbGlkZXNUb1Nob3cpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHNsaWNrID0gJHNsaWRlQ29sbGVjdGlvbi5zbGljaygnZ2V0U2xpY2snKTtcclxuICAgICAgICAgICAgICAgIGlmIChzbGljaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciAkaW5kaWNhdG9ycyA9IHNsaWNrLiRkb3RzO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkaW5kaWNhdG9ycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkaW5kaWNhdG9ycy5vbignY2xpY2snLCAnbGknLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2xpY2sgPSAkc2xpZGVDb2xsZWN0aW9uLnNsaWNrKCdnZXRTbGljaycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNsaWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpY2suc2xpY2tTZXRPcHRpb24oXCJhdXRvcGxheVwiLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWNrLmF1dG9QbGF5ID0gJC5ub29wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBJbiBvcmRlciB0byBtYWtlIHRoZSBjb250cm9scyBhcHBlYXIgd2hlcmUgS29obGVyIHdhbnRzIHRoZW0gYXQgYWxsIHNjcmVlbiBzaXplcyxcclxuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gc2l6ZSB0aGUgY29udHJvbHMgY29udGFpbmVyIHRvIG1hdGNoIHRoZSBiYW5uZXIgYmFja2dyb3VuZCwgYW5kIHRoZW4gd2VcclxuICAgICAgICAgICAgICAgIC8vIGNhbiBwb3NpdGlvbiB0aGUgY29udHJvbHMgYWNjb3JkaW5nbHkuXHJcbiAgICAgICAgICAgICAgICAkKHdpbmRvdykubG9hZChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwb3NpdGlvbkNvbnRyb2xzKCRjYXJvdXNlbENvbnRyb2xzLCAkZmlyc3RTbGlkZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdhaXRGb3JGaW5hbEV2ZW50KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3NpdGlvbkNvbnRyb2xzKCRjYXJvdXNlbENvbnRyb2xzLCAkZmlyc3RTbGlkZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMTAwLCBcImNhcm91c2VsVGltZXJcIiArIGNvbXBvbmVudEluZGV4ICsgY2Fyb3VzZWxJbmRleCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0pOyAvLyBlbmQgY2Fyb3VzZWwuZWFjaFxyXG4gICAgICAgIH0pOyAvLyBlbmQgY29tcG9uZW50cy5lYWNoXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciByZXBvc2l0aW9uQ29udHJvbHMgPSBmdW5jdGlvbiAoJGNvbnRyb2xzQ29udGFpbmVyLCAkcmVmZXJlbmNlU2xpZGUpIHtcclxuICAgICAgICB2YXIgYmdXaWR0aCA9IFwiXCI7XHJcbiAgICAgICAgdmFyIGJnSGVpZ2h0ID0gXCJcIjtcclxuXHJcbiAgICAgICAgdmFyICRiYW5uZXJCZyA9ICRyZWZlcmVuY2VTbGlkZS5jaGlsZHJlbihcIi5rb2gtYmFubmVyLWJhY2tncm91bmRcIikuZmlyc3QoKTtcclxuICAgICAgICBpZiAoJGJhbm5lckJnKSB7XHJcbiAgICAgICAgICAgIGJnV2lkdGggPSAkYmFubmVyQmcud2lkdGgoKTtcclxuICAgICAgICAgICAgYmdIZWlnaHQgPSAkYmFubmVyQmcuaGVpZ2h0KCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYmdXaWR0aCA9ICRyZWZlcmVuY2VTbGlkZS53aWR0aCgpO1xyXG4gICAgICAgICAgICBiZ0hlaWdodCA9ICRyZWZlcmVuY2VTbGlkZS5oZWlnaHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjb250cm9sc0NvbnRhaW5lci53aWR0aChiZ1dpZHRoKS5oZWlnaHQoYmdIZWlnaHQpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgaW5pdFNsaWRlcyA9IGZ1bmN0aW9uICgkc2xpZGVDb2xsZWN0aW9uLCBjb250YWluZXJJRCkge1xyXG4gICAgICAgIC8vIExvY2F0ZSBhbGwgaW5zdGFuY2VzIG9mIHRoZSBGb290ZXIgTmF2IGNvbXBvbmVudFxyXG4gICAgICAgIHZhciAkc2xpZGVzID0gJHNsaWRlQ29sbGVjdGlvbi5jaGlsZHJlbihcIi5rb2gtYmFubmVyLXNsaWRlXCIpO1xyXG5cclxuICAgICAgICAkc2xpZGVzLmVhY2goZnVuY3Rpb24gKHNsaWRlSW5kZXgpIHtcclxuICAgICAgICAgICAgdmFyICRzbGlkZSA9ICQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAvLyBGb3Igc2xpZGVzIHdpdGggYW4gb3ZlcmxheSwgYWRkIGNsaWNrIGV2ZW50cyBmb3IgYm9va21hcmsgYW5kIHNoYXJlIGJ1dHRvbnNcclxuICAgICAgICAgICAgdmFyICRvdmVybGF5Qm9va21hcmsgPSAkc2xpZGUuZmluZChcIi5rb2gtb3ZlcmxheS1ib29rbWFya1wiKTtcclxuICAgICAgICAgICAgdmFyICRvdmVybGF5Qm9va21hcmtCdXR0b24gPSAkb3ZlcmxheUJvb2ttYXJrLmNoaWxkcmVuKFwiLmtvaC1vdmVybGF5LWJvb2ttYXJrLWJ1dHRvblwiKTtcclxuICAgICAgICAgICAgdmFyICRvdmVybGF5Qm9va21hcmtQYW5lbCA9ICRvdmVybGF5Qm9va21hcmsuY2hpbGRyZW4oXCIua29oLW92ZXJsYXktYm9va21hcmstZm9ybVwiKTtcclxuICAgICAgICAgICAgaW5pdE92ZXJsYXlQb3BvdmVyKCRzbGlkZSwgJG92ZXJsYXlCb29rbWFya0J1dHRvbiwgJG92ZXJsYXlCb29rbWFya1BhbmVsLCBcImJvb2ttYXJrUG9wb3ZlclwiICsgY29udGFpbmVySUQgKyBzbGlkZUluZGV4KTtcclxuXHJcbiAgICAgICAgICAgIHZhciAkb3ZlcmxheVNoYXJlID0gJHNsaWRlLmZpbmQoXCIua29oLW92ZXJsYXktc29jaWFsXCIpO1xyXG4gICAgICAgICAgICB2YXIgJG92ZXJsYXlTaGFyZUJ1dHRvbiA9ICRvdmVybGF5U2hhcmUuY2hpbGRyZW4oXCIua29oLW92ZXJsYXktc2hhcmUtYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICB2YXIgJG92ZXJsYXlTaGFyZVBhbmVsID0gJG92ZXJsYXlTaGFyZS5jaGlsZHJlbihcIi5rb2gtb3ZlcmxheS1zaGFyZS1tZW51XCIpO1xyXG4gICAgICAgICAgICBpZiAoYXhLT0ggJiYgYXhLT0gudXRpbHMgJiYgYXhLT0gudXRpbHMuc29jaWFsU2hhcmUpIHtcclxuICAgICAgICAgICAgICAgIGF4S09ILnV0aWxzLnNvY2lhbFNoYXJlLmluaXRBc1Rvb2x0aXAoJHNsaWRlLCAkb3ZlcmxheVNoYXJlQnV0dG9uLCAkb3ZlcmxheVNoYXJlUGFuZWwsIFwic2hhcmVQb3BvdmVyXCIgKyBjb250YWluZXJJRCArIHNsaWRlSW5kZXgsIFwia29oLWNhcm91c2VsLXBvcG92ZXJcIik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEZvciBhbnkgaG90c3BvdCBzbGlkZXMsIGFkZCBjbGljayBldmVudCB0byB2aWV3IGZlYXR1cmVkIHByb2R1Y3RzXHJcbiAgICAgICAgICAgIGlmICgkc2xpZGUuaGFzQ2xhc3MoXCJ2LWtvaC1ob3RzcG90XCIpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGhvdHNwb3RzQ29udGFpbmVyID0gJHNsaWRlLmNoaWxkcmVuKFwiLmtvaC1iYW5uZXItaG90c3BvdHNcIikuZmlyc3QoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgJGhvdHNwb3RIZWFkZXIgPSAkaG90c3BvdHNDb250YWluZXIuY2hpbGRyZW4oXCIua29oLWJhbm5lci1ob3RzcG90cy1oZWFkZXJcIik7XHJcbiAgICAgICAgICAgICAgICAkaG90c3BvdEhlYWRlci5jbGljayh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiAkaG90c3BvdHNDb250YWluZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVDb2xsZWN0aW9uOiAkc2xpZGVDb2xsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZU9wZW4oZS5kYXRhLnRhcmdldCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIC5zbGljay1saXN0IHRoYXQgY29udGFpbnMgdGhpcyB0b2dnbGUgYW5kIHJlY2FsY3VsYXRlIHRoZSBzaXplXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRzbGlkZVNldCA9IGUuZGF0YS5zbGlkZUNvbGxlY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRhY3RpdmVTbGlkZSA9ICRzbGlkZVNldC5maW5kKCcuc2xpY2stYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlU2V0LmNoaWxkcmVuKCcuc2xpY2stbGlzdCcpLmhlaWdodCgkYWN0aXZlU2xpZGUuaGVpZ2h0KCkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyICRob3RzcG90cyA9ICRob3RzcG90c0NvbnRhaW5lci5jaGlsZHJlbihcIi5rb2gtYmFubmVyLWhvdHNwb3RzLWNvbGxlY3Rpb25cIikuY2hpbGRyZW4oXCIua29oLWJhbm5lci1ob3RzcG90XCIpO1xyXG4gICAgICAgICAgICAgICAgJGhvdHNwb3RzLmVhY2goZnVuY3Rpb24gKGhvdHNwb3RJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciAkaG90c3BvdCA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRob3RzcG90QnV0dG9uID0gJGhvdHNwb3QuY2hpbGRyZW4oXCIua29oLWJhbm5lci1ob3RzcG90LWljb25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRob3RzcG90UGFuZWwgPSAkaG90c3BvdC5jaGlsZHJlbihcIi5rb2gtYmFubmVyLWhvdHNwb3QtdGlsZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGlwSUQgPSBcImhvdHNwb3RQb3BvdmVyXCIgKyBjb250YWluZXJJRCArIHNsaWRlSW5kZXggKyBob3RzcG90SW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdE92ZXJsYXlIb3RzcG90KCRzbGlkZSwgJGhvdHNwb3RCdXR0b24sICRob3RzcG90UGFuZWwsIHRpcElEKTtcclxuICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEZvckZpbmFsRXZlbnQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdE92ZXJsYXlIb3RzcG90KCRzbGlkZSwgJGhvdHNwb3RCdXR0b24sICRob3RzcG90UGFuZWwsIHRpcElEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwLCBcImNhcm91c2VsVGltZXJcIiArIHRpcElEKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoJHNsaWRlLmhhc0NsYXNzKFwidi1rb2gtdmlkZW9cIikpIHtcclxuICAgICAgICAgICAgICAgIC8vIFZpZGVvIHNsaWRlcyBnZXQgZXh0cmEgaGFuZGxpbmcgZm9yIHRoZWlyIG1vZGFsIHdpbmRvd1xyXG4gICAgICAgICAgICAgICAgdmFyICRiYWNrZ3JvdW5kTGluayA9ICRzbGlkZS5jaGlsZHJlbihcIi5rb2gtYmFubmVyLWJhY2tncm91bmRcIikuY2hpbGRyZW4oXCJhXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyICR2aWRlb1BhbmVsID0gJHNsaWRlLmNoaWxkcmVuKFwiLmtvaC1iYW5uZXItdmlkZW8tcGFuZWxcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgaW5pdEFzTW9kYWwoJGJhY2tncm91bmRMaW5rLCAkdmlkZW9QYW5lbCwgXCJDYXJvdXNlbFZpZGVvXCIgKyBjb250YWluZXJJRCArIHNsaWRlSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgJHZpZGVvUGFuZWwub24oJ29wZW5lZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgJGVtYmVkZGVkVmlkZW8gPSAkKHRoaXMpLmZpbmQoXCJpZnJhbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplUmVzcG9uc2l2ZVZpZGVvKCRlbWJlZGRlZFZpZGVvKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBBdCBkZXNrdG9wIHNpemVzLCB0aGUga29oLWJhbm5lci1jb250ZW50IGNvbXBsZXRlbHkgY292ZXJzIHRoZSBrb2gtYmFubmVyLWJhY2tncm91bmQsIHNvIHRoZSBjbGlja1xyXG4gICAgICAgICAgICAvLyBjYW4ndCBnZXQgdGhyb3VnaC4gU28gbGV0J3MgbWFrZSB0aGUgY2xpY2sgZ2V0IHRocm91Z2g/XHJcbiAgICAgICAgICAgIHZhciAkYmFubmVyQmFja2dyb3VuZCA9ICRzbGlkZS5jaGlsZHJlbihcIi5rb2gtYmFubmVyLWJhY2tncm91bmRcIik7XHJcbiAgICAgICAgICAgIHZhciAkYmFubmVyQ29udGVudCA9ICRzbGlkZS5jaGlsZHJlbihcIi5rb2gtYmFubmVyLWNvbnRlbnRcIik7XHJcbiAgICAgICAgICAgICRiYW5uZXJDb250ZW50LmNsaWNrKHtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICRiYW5uZXJCYWNrZ3JvdW5kXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGJhbm5lckNvbnRlbnQgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgdmFyICRiYW5uZXJCYWNrZ3JvdW5kID0gZS5kYXRhLmJhY2tncm91bmQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCgkYmFubmVyQ29udGVudC5vZmZzZXQoKS50b3AgPT09ICRiYW5uZXJCYWNrZ3JvdW5kLm9mZnNldCgpLnRvcCkgJiZcclxuICAgICAgICAgICAgICAgICAgICAoJGJhbm5lckNvbnRlbnQub2Zmc2V0KCkubGVmdCA9PT0gJGJhbm5lckJhY2tncm91bmQub2Zmc2V0KCkubGVmdCkgJiZcclxuICAgICAgICAgICAgICAgICAgICAoJGJhbm5lckNvbnRlbnQub3V0ZXJXaWR0aCgpID09PSAkYmFubmVyQmFja2dyb3VuZC5vdXRlcldpZHRoKCkpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgKCRiYW5uZXJDb250ZW50Lm91dGVySGVpZ2h0KCkgPT09ICRiYW5uZXJCYWNrZ3JvdW5kLm91dGVySGVpZ2h0KCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRsaW5rcyA9ICRiYW5uZXJCYWNrZ3JvdW5kLmNoaWxkcmVuKFwiYVwiKS5maXJzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IEhhdmUgdG8gZG8gdGhpcyB3aXRoIGEgbmF0aXZlIEphdmFzY3JpcHQgY2xpY2sgYmVjYXVzZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGpRdWVyeSBjbGljayBkb2VzIG5vdCB0cmlnZ2VyIGRlZmF1bHQgYnJvd3NlciBiZWhhdmlvclxyXG4gICAgICAgICAgICAgICAgICAgICRsaW5rc1swXS5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGluaXRPdmVybGF5UG9wb3ZlciA9IGZ1bmN0aW9uICgkc2xpZGUsICRidXR0b24sICRjb250ZW50LCB0b29sdGlwSUQpIHtcclxuICAgICAgICAkYnV0dG9uLnF0aXAoe1xyXG4gICAgICAgICAgICBpZDogdG9vbHRpcElELFxyXG4gICAgICAgICAgICBjb250ZW50OiB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0OiAkY29udGVudFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwb3NpdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgbXk6ICdib3R0b20gcmlnaHQnLCAvLyBQb3NpdGlvbiBteSB0b3AgbGVmdC4uLlxyXG4gICAgICAgICAgICAgICAgYXQ6ICdjZW50ZXIgY2VudGVyJywgLy8gYXQgdGhlIGJvdHRvbSByaWdodCBvZi4uLlxyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiAkc2xpZGUsXHJcbiAgICAgICAgICAgICAgICB2aWV3cG9ydDogdHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBoaWRlOiB7XHJcbiAgICAgICAgICAgICAgICB3aGVuOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ6ICdtb3VzZW91dCB1bmZvY3VzJ1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZpeGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZGVsYXk6IDEwMFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzdHlsZToge1xyXG4gICAgICAgICAgICAgICAgY2xhc3NlczogJ2tvaC1xdGlwLXBvcG92ZXIga29oLWNhcm91c2VsLXBvcG92ZXIgcXRpcC1saWdodCBxdGlwLXNoYWRvdycsXHJcbiAgICAgICAgICAgICAgICB0aXA6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGluaXRPdmVybGF5SG90c3BvdCA9IGZ1bmN0aW9uICgkc2xpZGUsICRidXR0b24sICRjb250ZW50LCB0b29sdGlwSUQpIHtcclxuICAgICAgICAvLyBpZiBtb2JpbGVcclxuICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPCA5ODApIHtcclxuICAgICAgICAgICAgaWYgKCRidXR0b24uZGF0YSgncXRpcCcpICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAkYnV0dG9uLnF0aXAoJ2Rlc3Ryb3knLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBlbHNlIGlmIGRlc2t0b3BcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgJGJ1dHRvbi5xdGlwKHtcclxuICAgICAgICAgICAgICAgIGlkOiB0b29sdGlwSUQsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJGNvbnRlbnQuY2xvbmUoKVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbXk6ICdyaWdodCB0b3AnLCAvLyBQb3NpdGlvbiBteSB0b3AgbGVmdC4uLlxyXG4gICAgICAgICAgICAgICAgICAgIGF0OiAnbGVmdCB0b3AnLCAvLyBhdCB0aGUgYm90dG9tIHJpZ2h0IG9mLi4uXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiAkc2xpZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmlld3BvcnQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgYWRqdXN0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ2ZsaXAgc2hpZnQnXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhpZGU6IHtcclxuICAgICAgICAgICAgICAgICAgICB3aGVuOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnbW91c2VvdXQgdW5mb2N1cydcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZpeGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlbGF5OiAxMDBcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzdHlsZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzZXM6ICdrb2gtcXRpcC1wb3BvdmVyIGtvaC1jYXJvdXNlbC1wb3BvdmVyIHF0aXAtbGlnaHQgcXRpcC1zaGFkb3cnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpcDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW1pYzogJ2NlbnRlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAzMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxNVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKiBIZWxwZXIgRnVuY3Rpb25zICovXHJcbiAgICB2YXIgaW5pdEFzTW9kYWwgPSBmdW5jdGlvbiAoJGJ1dHRvbiwgJHBhbmVsLCByZW1vZGFsSUQpIHtcclxuICAgICAgICAkcGFuZWwuZGF0YShcInJlbW9kYWwtaWRcIiwgcmVtb2RhbElEKTtcclxuICAgICAgICAkcGFuZWwucHJlcGVuZCgnPGJ1dHRvbiBkYXRhLXJlbW9kYWwtYWN0aW9uPVwiY2xvc2VcIiBjbGFzcz1cInJlbW9kYWwtY2xvc2VcIj48L2J1dHRvbj4nKTtcclxuICAgICAgICAkcGFuZWwuYXR0cihcImRhdGEta29oLWNvbXBvbmVudFwiLCBcImMta29oLWJhbm5lci1jYXJvdXNlbFwiKTtcclxuICAgICAgICAkcGFuZWwuYWRkQ2xhc3MoXCJjLWtvaC1iYW5uZXItY2Fyb3VzZWwtbW9kYWxcIik7XHJcblxyXG4gICAgICAgIHZhciAkcmVtb2RhbFBhbmVsID0gJHBhbmVsLnJlbW9kYWwoe1xyXG4gICAgICAgICAgICBoYXNoVHJhY2tpbmc6IHRydWUsXHJcbiAgICAgICAgICAgIGNsb3NlT25DYW5jZWw6IHRydWUsXHJcbiAgICAgICAgICAgIGNsb3NlT25Fc2NhcGU6IHRydWUsXHJcbiAgICAgICAgICAgIGNsb3NlT25PdXRzaWRlQ2xpY2s6IHRydWUsXHJcbiAgICAgICAgICAgIG1vZGlmaWVyOiAnJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBNYWtlIHRoZSBidXR0b24gYWxsIGJ1dHRvbi15IGFuZCBjbGljay15XHJcbiAgICAgICAgJGJ1dHRvbi5kYXRhKFwicmVtb2RhbC10YXJnZXRcIiwgcmVtb2RhbElEKTtcclxuICAgICAgICAkYnV0dG9uLmNsaWNrKHtcclxuICAgICAgICAgICAgdGFyZ2V0OiAkcmVtb2RhbFBhbmVsXHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB2YXIgJHRhcmdldCA9IGUuZGF0YS50YXJnZXQ7XHJcbiAgICAgICAgICAgICR0YXJnZXQub3BlbigpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBXaGVuIG1vZGFsIGlzIGNsb3NlZCwgcmVzZXQgc3JjIG9uIGFueSBZb3VUdWJlIGlmcmFtZXMgdG8gc3RvcCB2aWRlb3NcclxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xvc2VkJywgJHJlbW9kYWxQYW5lbCwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICBheEtPSC51dGlscy5zdG9wVmlkZW9zKGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgdG9nZ2xlT3BlbiA9IGZ1bmN0aW9uICgkdGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKCR0YXJnZXQuaGFzQ2xhc3MoXCJvcGVuXCIpKSB7XHJcbiAgICAgICAgICAgICR0YXJnZXQucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICR0YXJnZXQuYWRkQ2xhc3MoXCJvcGVuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIG1ha2VWaWRlb1Jlc3BvbnNpdmUgPSBmdW5jdGlvbiAoJHZpZGVvRWxlbWVudCkge1xyXG4gICAgICAgIHZhciBhc3BlY3RSYXRpbyA9ICR2aWRlb0VsZW1lbnQuZGF0YSgnYXNwZWN0cmF0aW8nKTtcclxuICAgICAgICB2YXIgbWF4V2lkdGggPSAkdmlkZW9FbGVtZW50LmRhdGEoJ21heHdpZHRoJyk7XHJcblxyXG4gICAgICAgIGlmICghYXNwZWN0UmF0aW8gfHwgIW1heFdpZHRoKSB7XHJcbiAgICAgICAgICAgIHZhciB3aWR0aCA9ICR2aWRlb0VsZW1lbnQud2lkdGgoKTtcclxuICAgICAgICAgICAgdmFyIGhlaWdodCA9ICR2aWRlb0VsZW1lbnQuaGVpZ2h0KCk7XHJcblxyXG4gICAgICAgICAgICBhc3BlY3RSYXRpbyA9IGhlaWdodCAvIHdpZHRoO1xyXG5cclxuICAgICAgICAgICAgLy8gRmluZCBhbmQgc2F2ZSB0aGUgYXNwZWN0IHJhdGlvLCBhbmQgdGhlIG9yaWdpbmFsIHdpZHRoXHJcbiAgICAgICAgICAgICR2aWRlb0VsZW1lbnQuZGF0YSgnYXNwZWN0cmF0aW8nLCBhc3BlY3RSYXRpbyk7XHJcbiAgICAgICAgICAgICR2aWRlb0VsZW1lbnQuZGF0YSgnbWF4d2lkdGgnLCB3aWR0aCk7XHJcbiAgICAgICAgICAgICR2aWRlb0VsZW1lbnQucmVtb3ZlQXR0cignd2lkdGgnKTtcclxuICAgICAgICAgICAgJHZpZGVvRWxlbWVudC5yZW1vdmVBdHRyKCdoZWlnaHQnKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciByZXNpemVSZXNwb25zaXZlVmlkZW8gPSBmdW5jdGlvbiAoJHZpZGVvRWxlbWVudCkge1xyXG4gICAgICAgIHZhciBlbWJlZFRhZ3MgPSBcImlmcmFtZSwgb2JqZWN0LCBlbWJlZFwiO1xyXG4gICAgICAgIHZhciBhc3BlY3RSYXRpbyA9ICR2aWRlb0VsZW1lbnQuZGF0YSgnYXNwZWN0cmF0aW8nKTtcclxuICAgICAgICB2YXIgbWF4V2lkdGggPSAkdmlkZW9FbGVtZW50LmRhdGEoJ21heHdpZHRoJyk7XHJcblxyXG4gICAgICAgIGlmICghYXNwZWN0UmF0aW8gfHwgIW1heFdpZHRoKSB7XHJcbiAgICAgICAgICAgIG1ha2VWaWRlb1Jlc3BvbnNpdmUoJHZpZGVvRWxlbWVudCk7XHJcbiAgICAgICAgICAgIGFzcGVjdFJhdGlvID0gJHZpZGVvRWxlbWVudC5kYXRhKCdhc3BlY3RyYXRpbycpO1xyXG4gICAgICAgICAgICBtYXhXaWR0aCA9ICR2aWRlb0VsZW1lbnQuZGF0YSgnbWF4d2lkdGgnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciAkcGFyZW50ID0gJHZpZGVvRWxlbWVudC5jbG9zZXN0KCc6bm90KCcgKyBlbWJlZFRhZ3MgKyAnKScpO1xyXG5cclxuICAgICAgICB2YXIgcmVzcG9uc2l2ZVdpZHRoID0gMzIwOyAvLyBpbiBjYXNlIHdlIGNhbid0IGZpbmQgYSBwYXJlbnQsIHNldCB0byBzbWFsbGVzdCBwb3NzaWJsZSBzY3JlZW4gd2lkdGhcclxuICAgICAgICBpZiAoJHBhcmVudCkge1xyXG4gICAgICAgICAgICByZXNwb25zaXZlV2lkdGggPSAkcGFyZW50LndpZHRoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIERvbid0IGV4Y2VlZCB0aGUgb3JpZ2luYWwgd2lkdGggKGkuZS4gZG9uJ3Qgc2NhbGUgdXAsIG9ubHkgZG93bilcclxuICAgICAgICByZXNwb25zaXZlV2lkdGggPSBNYXRoLm1pbihyZXNwb25zaXZlV2lkdGgsIG1heFdpZHRoKTtcclxuXHJcbiAgICAgICAgJHZpZGVvRWxlbWVudC53aWR0aChyZXNwb25zaXZlV2lkdGgpO1xyXG4gICAgICAgICR2aWRlb0VsZW1lbnQuaGVpZ2h0KHJlc3BvbnNpdmVXaWR0aCAqIGFzcGVjdFJhdGlvKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHRpbWVycyA9IHt9O1xyXG4gICAgdmFyIHdhaXRGb3JGaW5hbEV2ZW50ID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBtcywgdW5pcXVlSWQpIHtcclxuICAgICAgICBpZiAoIXVuaXF1ZUlkKSB7XHJcbiAgICAgICAgICAgIHVuaXF1ZUlkID0gXCJVTklRVUVJRFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGltZXJzW3VuaXF1ZUlkXSkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJzW3VuaXF1ZUlkXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRpbWVyc1t1bmlxdWVJZF0gPSBzZXRUaW1lb3V0KGNhbGxiYWNrLCBtcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qIERlZmluZXMgZnVuY3Rpb25zIGV4cG9zZWQgdGhyb3VnaCBvYmplY3QgKi9cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpbml0Q2Fyb3VzZWwoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KSgpO1xyXG5cclxuJChmdW5jdGlvbiAoKSB7XHJcbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8gZXhlY3V0ZXMgd2hlbiBIVE1MLURvY3VtZW50IGlzIGxvYWRlZCBhbmQgRE9NIGlzIHJlYWR5XHJcbiAgICAgICAgYXhLT0gubWFpbi5jYXJvdXNlbE1hbmFnZXIuaW5pdCgpO1xyXG4gICAgfSk7XHJcbn0pOyJdfQ==
