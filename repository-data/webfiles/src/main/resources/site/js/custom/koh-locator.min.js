/*
 * Copyright Â© 2000-2017 Kohler Company. All Rights Reserved.
*/
function GetMap(){function getUrlVars(url){for(var hash,vars=[],hashes=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++)hash=hashes[i].split("="),vars.push(hash[1]);return vars}var dataSource=$(".koh-bingdatasource").data("bingdatasource"),masterKey=$(".koh-bingdatasourcekeys").data("bingdatasourcekeys"),languageCode=$(".koh-bingdatasourcelanguage").data("bingdatasourcelanguage"),url=window.location.href,lat=getUrlVars(url)[2],lon=getUrlVars(url)[1],map=new Microsoft.Maps.Map(document.getElementById("myMap"),{credentials:masterKey,center:new Microsoft.Maps.Location(lat,lon),zoom:15}),sdsDataSourceUrl=dataSource;Microsoft.Maps.loadModule("Microsoft.Maps.SpatialDataService",function(){var queryOptions={queryUrl:sdsDataSourceUrl,spatialFilter:{spatialFilterType:"nearby",location:map.getCenter(),radius:20}};Microsoft.Maps.SpatialDataService.QueryAPIManager.search(queryOptions,map,function(data){function displayInfobox_EnglishSite(obj){var addressTable="<table>",displayName="",addressLine="";void 0!=obj&&(void 0!=obj.metadata.LocationName&&""!=obj.metadata.LocationName&&(displayName+="<tr><td>"+obj.metadata.LocationName+"</td></tr>"),void 0!=obj.metadata.AddressLine&&""!=obj.metadata.AddressLine&&(addressLine+=obj.metadata.AddressLine+", "),void 0!=obj.metadata.Locality&&""!=obj.metadata.Locality&&(addressLine+=obj.metadata.Locality+", "),void 0!=obj.metadata.AdminDistrict&&""!=obj.metadata.AdminDistrict&&obj.metadata.Locality!=obj.metadata.AdminDistrict&&(addressLine+=obj.metadata.AdminDistrict+", "),void 0!=obj.metadata.PostalCode&&""!=obj.metadata.PostalCode&&(addressLine+=obj.metadata.PostalCode+", "),addressTable+=displayName,addressTable+="<tr><td>"+addressLine.slice(0,addressLine.length-2)+"</td></tr>"),addressTable+="</table>",infobox.setOptions({visible:!0,description:addressTable})}function displayInfobox_LanguageSite(obj){var addressTable="<table>",displayName="",addressLine="";void 0!=obj&&(void 0!=obj.metadata.LocationNameAlternate&&""!=obj.metadata.LocationNameAlternate&&(displayName+="<tr><td>"+obj.metadata.LocationNameAlternate+"</td></tr>"),void 0!=obj.metadata.AddressLineAlternate&&""!=obj.metadata.AddressLineAlternate&&(addressLine+=obj.metadata.AddressLineAlternate+", "),void 0!=obj.metadata.LocalityAlternate&&""!=obj.metadata.LocalityAlternate&&(addressLine+=obj.metadata.LocalityAlternate+", "),void 0!=obj.metadata.AdminDistrictAlternate&&""!=obj.metadata.AdminDistrictAlternate&&obj.metadata.LocalityAlternate!=obj.metadata.AdminDistrictAlternate&&(addressLine+=obj.metadata.AdminDistrictAlternate+", "),void 0!=obj.metadata.PostalCode&&""!=obj.metadata.PostalCode&&(addressLine+=obj.metadata.PostalCode+", "),addressTable+=displayName,addressTable+="<tr><td>"+addressLine.slice(0,addressLine.length-2)+"</td></tr>"),addressTable+="</table>",infobox.setOptions({visible:!0,description:addressTable})}var obj=data[0],pushpin=new Microsoft.Maps.Pushpin(map.getCenter(),{icon:$("#redpin").val(),text:"1"});map.entities.push(pushpin);var infobox=new Microsoft.Maps.Infobox(map.getCenter(),{visible:!1});infobox.setMap(map),Microsoft.Maps.Events.addHandler(pushpin,"click",function(e){"en"==languageCode?displayInfobox_EnglishSite(obj):displayInfobox_LanguageSite(obj)})},null,!1,function(status,message){document.getElementById("printoutPanel").innerHTML="Search failure. NetworkStatus: "+status})})}